# ğŸ“˜ WEEK 6 - PHáº¦N 1: Tá»”NG QUAN LAMBDA ARCHITECTURE

## ğŸ“‘ Má»¥c lá»¥c
1. [Váº¥n Ä‘á» cáº§n giáº£i quyáº¿t](#1-váº¥n-Ä‘á»-cáº§n-giáº£i-quyáº¿t)
2. [Lambda Architecture lÃ  gÃ¬?](#2-lambda-architecture-lÃ -gÃ¬)
3. [Táº¡i sao chá»n Lambda Architecture?](#3-táº¡i-sao-chá»n-lambda-architecture)
4. [Kiáº¿n trÃºc tá»•ng thá»ƒ cá»§a project](#4-kiáº¿n-trÃºc-tá»•ng-thá»ƒ-cá»§a-project)
5. [Luá»“ng dá»¯ liá»‡u chi tiáº¿t](#5-luá»“ng-dá»¯-liá»‡u-chi-tiáº¿t)
6. [CÃ¡c cÃ´ng nghá»‡ sá»­ dá»¥ng](#6-cÃ¡c-cÃ´ng-nghá»‡-sá»­-dá»¥ng)
7. [Cáº¥u trÃºc thÆ° má»¥c](#7-cáº¥u-trÃºc-thÆ°-má»¥c)
8. [CÃ¢u há»i thÆ°á»ng gáº·p tá»« giáº£ng viÃªn](#8-cÃ¢u-há»i-thÆ°á»ng-gáº·p-tá»«-giáº£ng-viÃªn)

---

## 1. Váº¥n Ä‘á» cáº§n giáº£i quyáº¿t

### 1.1. Bá»‘i cáº£nh project

Trong cÃ¡c tuáº§n trÆ°á»›c (Week 1-5), chÃºng ta Ä‘Ã£:
- **Week 1-2**: Thu tháº­p dá»¯ liá»‡u lá»‹ch sá»­ BTC/ETH tá»« file CSV (2012-2025)
- **Week 3**: Tiá»n xá»­ lÃ½, lÃ m sáº¡ch dá»¯ liá»‡u vá»›i Spark
- **Week 4**: XÃ¢y dá»±ng model Prophet Ä‘á»ƒ dá»± Ä‘oÃ¡n giÃ¡
- **Week 5**: Tá»‘i Æ°u vÃ  Ä‘Ã¡nh giÃ¡ model

**Váº¥n Ä‘á» phÃ¡t sinh**: Dá»¯ liá»‡u CSV lÃ  **tÄ©nh** (static). Sau khi thu tháº­p xong, náº¿u muá»‘n dá»± Ä‘oÃ¡n giÃ¡ ngÃ y mai, chÃºng ta cáº§n:
1. Táº£i láº¡i file CSV má»›i
2. Cháº¡y láº¡i toÃ n bá»™ pipeline
3. Train láº¡i model

â†’ **KhÃ´ng hiá»‡u quáº£** vÃ  **khÃ´ng real-time**!

### 1.2. YÃªu cáº§u cá»§a Week 6

Week 6 yÃªu cáº§u xá»­ lÃ½ **Structured Streaming** - tá»©c lÃ :
- Thu tháº­p dá»¯ liá»‡u **real-time** (thá»i gian thá»±c)
- Xá»­ lÃ½ dá»¯ liá»‡u **liÃªn tá»¥c** (continuous processing)
- Káº¿t há»£p vá»›i dá»¯ liá»‡u **lá»‹ch sá»­** (historical data)

### 1.3. ThÃ¡ch thá»©c thá»±c táº¿

LÃ  sinh viÃªn, chÃºng ta gáº·p má»™t sá»‘ háº¡n cháº¿:
- âŒ KhÃ´ng cÃ³ server cháº¡y 24/7
- âŒ KhÃ´ng thá»ƒ Ä‘á»ƒ mÃ¡y tÃ­nh báº­t liÃªn tá»¥c
- âŒ Má»—i láº§n má»Ÿ project cÃ¡ch nhau vÃ i ngÃ y

**VÃ­ dá»¥ thá»±c táº¿:**
```
NgÃ y 24/11: Cháº¡y project, dá»¯ liá»‡u Ä‘áº¿n 24/11
NgÃ y 03/12: Má»Ÿ láº¡i project
â†’ Gap 9 ngÃ y (25/11 - 03/12) khÃ´ng cÃ³ dá»¯ liá»‡u!
```

**CÃ¢u há»i**: LÃ m sao Ä‘á»ƒ:
1. Tá»± Ä‘á»™ng láº¥y dá»¯ liá»‡u nhá»¯ng ngÃ y bá»‹ thiáº¿u (gap)?
2. Váº«n demo Ä‘Æ°á»£c streaming real-time?
3. Káº¿t há»£p táº¥t cáº£ Ä‘á»ƒ forecast?

â†’ **Giáº£i phÃ¡p: Lambda Architecture**

---

## 2. Lambda Architecture lÃ  gÃ¬?

### 2.1. Äá»‹nh nghÄ©a

**Lambda Architecture** lÃ  má»™t kiáº¿n trÃºc xá»­ lÃ½ dá»¯ liá»‡u lá»›n (Big Data) Ä‘Æ°á»£c thiáº¿t káº¿ bá»Ÿi **Nathan Marz** (ngÆ°á»i táº¡o Apache Storm). Kiáº¿n trÃºc nÃ y giáº£i quyáº¿t váº¥n Ä‘á» xá»­ lÃ½ **cáº£ dá»¯ liá»‡u batch vÃ  real-time** trong cÃ¹ng má»™t há»‡ thá»‘ng.

### 2.2. Ba Layer chÃ­nh

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      LAMBDA ARCHITECTURE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                         â”‚  DATA SOURCE â”‚                            â”‚
â”‚                         â”‚  (Binance    â”‚                            â”‚
â”‚                         â”‚   API)       â”‚                            â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                â”‚                                    â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚              â”‚                 â”‚                 â”‚                  â”‚
â”‚              â–¼                 â”‚                 â–¼                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚   BATCH LAYER    â”‚         â”‚      â”‚   SPEED LAYER    â”‚          â”‚
â”‚   â”‚                  â”‚         â”‚      â”‚                  â”‚          â”‚
â”‚   â”‚  â€¢ Xá»­ lÃ½ dá»¯ liá»‡u â”‚         â”‚      â”‚  â€¢ Xá»­ lÃ½ dá»¯ liá»‡u â”‚          â”‚
â”‚   â”‚    lá»‹ch sá»­       â”‚         â”‚      â”‚    real-time     â”‚          â”‚
â”‚   â”‚  â€¢ ChÃ­nh xÃ¡c     â”‚         â”‚      â”‚  â€¢ Nhanh         â”‚          â”‚
â”‚   â”‚  â€¢ Cháº­m          â”‚         â”‚      â”‚  â€¢ Gáº§n Ä‘Ãºng      â”‚          â”‚
â”‚   â”‚                  â”‚         â”‚      â”‚                  â”‚          â”‚
â”‚   â”‚  week6_backfill  â”‚         â”‚      â”‚  Kafka + Spark   â”‚          â”‚
â”‚   â”‚  .py             â”‚         â”‚      â”‚  Streaming       â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚            â”‚                   â”‚               â”‚                    â”‚
â”‚            â”‚                   â”‚               â”‚                    â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                â”‚                                    â”‚
â”‚                                â–¼                                    â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                     â”‚  SERVING LAYER   â”‚                            â”‚
â”‚                     â”‚                  â”‚                            â”‚
â”‚                     â”‚  â€¢ Merge batch   â”‚                            â”‚
â”‚                     â”‚    + streaming   â”‚                            â”‚
â”‚                     â”‚  â€¢ Phá»¥c vá»¥ query â”‚                            â”‚
â”‚                     â”‚                  â”‚                            â”‚
â”‚                     â”‚  week6_merge.py  â”‚                            â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                     â”‚    FORECAST      â”‚                            â”‚
â”‚                     â”‚  prophet_train   â”‚                            â”‚
â”‚                     â”‚  .py             â”‚                            â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3. Giáº£i thÃ­ch tá»«ng Layer

#### ğŸ”µ BATCH LAYER (Lá»›p xá»­ lÃ½ theo lÃ´)

**Nhiá»‡m vá»¥:**
- Xá»­ lÃ½ **toÃ n bá»™ dá»¯ liá»‡u lá»‹ch sá»­** (historical data)
- TÃ­nh toÃ¡n **chÃ­nh xÃ¡c** nhÆ°ng **cháº­m**
- Cháº¡y **Ä‘á»‹nh ká»³** (má»—i ngÃ y, má»—i tuáº§n, hoáº·c khi cáº§n)

**Trong project cá»§a chÃºng ta:**
- File: `week6_backfill.py`
- Chá»©c nÄƒng: PhÃ¡t hiá»‡n gap vÃ  fetch dá»¯ liá»‡u tá»« Binance API
- VÃ­ dá»¥: Náº¿u dá»¯ liá»‡u cuá»‘i lÃ  24/11, hÃ´m nay lÃ  03/12 â†’ fetch 9 ngÃ y gap

**Äáº·c Ä‘iá»ƒm:**
```
âœ… Æ¯u Ä‘iá»ƒm:
   - Káº¿t quáº£ chÃ­nh xÃ¡c 100%
   - Xá»­ lÃ½ Ä‘Æ°á»£c lÆ°á»£ng lá»›n dá»¯ liá»‡u
   - CÃ³ thá»ƒ tÃ­nh toÃ¡n láº¡i náº¿u cÃ³ lá»—i

âŒ NhÆ°á»£c Ä‘iá»ƒm:
   - Cháº­m (pháº£i Ä‘á»£i xá»­ lÃ½ xong má»›i cÃ³ káº¿t quáº£)
   - KhÃ´ng real-time
   - Tá»‘n tÃ i nguyÃªn
```

#### ğŸŸ¢ SPEED LAYER (Lá»›p xá»­ lÃ½ nhanh)

**Nhiá»‡m vá»¥:**
- Xá»­ lÃ½ dá»¯ liá»‡u **real-time** (thá»i gian thá»±c)
- TÃ­nh toÃ¡n **nhanh** nhÆ°ng cÃ³ thá»ƒ **gáº§n Ä‘Ãºng**
- Cháº¡y **liÃªn tá»¥c** 24/7

**Trong project cá»§a chÃºng ta:**
- Files: `websocket_producer.py`, `spark_streaming_consumer.py`
- CÃ´ng nghá»‡: Apache Kafka + Spark Structured Streaming
- Chá»©c nÄƒng: Thu tháº­p giÃ¡ BTC/ETH real-time tá»« Binance

**Äáº·c Ä‘iá»ƒm:**
```
âœ… Æ¯u Ä‘iá»ƒm:
   - Cá»±c nhanh (Ä‘á»™ trá»… < 1 giÃ¢y)
   - Real-time
   - Pháº£n á»©ng ngay vá»›i thay Ä‘á»•i

âŒ NhÆ°á»£c Ä‘iá»ƒm:
   - CÃ³ thá»ƒ thiáº¿u chÃ­nh xÃ¡c (do xá»­ lÃ½ nhanh)
   - Chá»‰ xá»­ lÃ½ dá»¯ liá»‡u má»›i
   - Cáº§n cháº¡y liÃªn tá»¥c
```

#### ğŸŸ¡ SERVING LAYER (Lá»›p phá»¥c vá»¥)

**Nhiá»‡m vá»¥:**
- **Merge** káº¿t quáº£ tá»« Batch Layer vÃ  Speed Layer
- Cung cáº¥p **má»™t view thá»‘ng nháº¥t** cho á»©ng dá»¥ng
- Phá»¥c vá»¥ cÃ¡c **query** tá»« user

**Trong project cá»§a chÃºng ta:**
- File: `week6_merge.py`
- Chá»©c nÄƒng: Káº¿t há»£p dá»¯ liá»‡u backfill + streaming thÃ nh má»™t timeline

**Äáº·c Ä‘iá»ƒm:**
```
âœ… Æ¯u Ä‘iá»ƒm:
   - CÃ³ cáº£ tÃ­nh chÃ­nh xÃ¡c (tá»« Batch) vÃ  tÃ­nh má»›i (tá»« Speed)
   - Dá»¯ liá»‡u liá»n máº¡ch
   - Dá»… query

âŒ NhÆ°á»£c Ä‘iá»ƒm:
   - Phá»©c táº¡p hÆ¡n trong viá»‡c Ä‘á»“ng bá»™
   - Cáº§n logic merge Ä‘Ãºng
```

---

## 3. Táº¡i sao chá»n Lambda Architecture?

### 3.1. So sÃ¡nh vá»›i cÃ¡c kiáº¿n trÃºc khÃ¡c

| TiÃªu chÃ­ | Batch Only | Streaming Only | Lambda Architecture |
|----------|------------|----------------|---------------------|
| Real-time | âŒ | âœ… | âœ… |
| Xá»­ lÃ½ lá»‹ch sá»­ | âœ… | âŒ | âœ… |
| Äá»™ chÃ­nh xÃ¡c | âœ… Cao | âš ï¸ Trung bÃ¬nh | âœ… Cao |
| Äá»™ phá»©c táº¡p | ğŸŸ¢ Tháº¥p | ğŸŸ¢ Tháº¥p | ğŸŸ¡ Trung bÃ¬nh |
| Kháº£ nÄƒng má»Ÿ rá»™ng | âœ… | âœ… | âœ… |
| Fault tolerance | âœ… | âš ï¸ | âœ… |

### 3.2. Táº¡i sao phÃ¹ há»£p vá»›i project nÃ y?

**LÃ½ do 1: Giáº£i quyáº¿t váº¥n Ä‘á» gap**
```
Váº¥n Ä‘á»: MÃ¡y tÃ­nh khÃ´ng cháº¡y 24/7 â†’ cÃ³ gap dá»¯ liá»‡u
Giáº£i phÃ¡p: Batch Layer tá»± Ä‘á»™ng backfill gap
```

**LÃ½ do 2: Váº«n demo Ä‘Æ°á»£c streaming**
```
YÃªu cáº§u: Week 6 cáº§n demo Structured Streaming
Giáº£i phÃ¡p: Speed Layer cháº¡y Kafka + Spark real-time
```

**LÃ½ do 3: Káº¿t há»£p táº¥t cáº£ Ä‘á»ƒ forecast**
```
Má»¥c tiÃªu: Dá»± Ä‘oÃ¡n giÃ¡ vá»›i dá»¯ liá»‡u má»›i nháº¥t
Giáº£i phÃ¡p: Serving Layer merge â†’ Prophet forecast
```

### 3.3. CÃ¡c cÃ´ng ty lá»›n sá»­ dá»¥ng Lambda Architecture

| CÃ´ng ty | Use case |
|---------|----------|
| **Netflix** | Recommendation engine, analytics |
| **LinkedIn** | Activity stream, analytics |
| **Twitter** | Real-time trending, analytics |
| **Uber** | Real-time pricing, demand prediction |
| **Spotify** | Music recommendation, listening history |

â†’ ÄÃ¢y lÃ  kiáº¿n trÃºc **production-grade**, Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi cÃ¡c cÃ´ng ty hÃ ng Ä‘áº§u!

---

## 4. Kiáº¿n trÃºc tá»•ng thá»ƒ cá»§a project

### 4.1. SÆ¡ Ä‘á»“ chi tiáº¿t

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DATA SOURCES                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚  Historical CSV â”‚              â”‚   Binance API   â”‚                       â”‚
â”‚  â”‚  (2012-2025)    â”‚              â”‚   (Real-time)   â”‚                       â”‚
â”‚  â”‚                 â”‚              â”‚                 â”‚                       â”‚
â”‚  â”‚  BTCUSDT.csv    â”‚              â”‚  /api/v3/ticker â”‚                       â”‚
â”‚  â”‚  ETHUSDT.csv    â”‚              â”‚                 â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚           â”‚                                â”‚                                â”‚
â”‚           â”‚ Week 1-5                       â”‚ Week 6                         â”‚
â”‚           â”‚ Pipeline                       â”‚                                â”‚
â”‚           â–¼                                â–¼                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           PROCESSING LAYERS                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚       BATCH LAYER           â”‚    â”‚       SPEED LAYER           â”‚         â”‚
â”‚  â”‚                             â”‚    â”‚                             â”‚         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚
â”‚  â”‚  â”‚ week6_backfill.py     â”‚  â”‚    â”‚  â”‚ websocket_producer.py â”‚  â”‚         â”‚
â”‚  â”‚  â”‚                       â”‚  â”‚    â”‚  â”‚                       â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ 1. Detect last date   â”‚  â”‚    â”‚  â”‚ 1. Poll Binance API   â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ 2. Calculate gap      â”‚  â”‚    â”‚  â”‚ 2. Send to Kafka      â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ 3. Fetch from API     â”‚  â”‚    â”‚  â”‚                       â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ 4. Clean & aggregate  â”‚  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚
â”‚  â”‚  â”‚ 5. Compute MA7/MA30   â”‚  â”‚    â”‚              â”‚              â”‚         â”‚
â”‚  â”‚  â”‚ 6. Save to Parquet    â”‚  â”‚    â”‚              â–¼              â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚  â”‚   Apache Kafka        â”‚  â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚  â”‚   (Message Broker)    â”‚  â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚  â”‚                       â”‚  â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚  â”‚   Topic: crypto-pricesâ”‚  â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚              â”‚              â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚              â–¼              â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚  â”‚ spark_streaming_      â”‚  â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚  â”‚ consumer.py           â”‚  â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚  â”‚                       â”‚  â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚  â”‚ 1. Read from Kafka    â”‚  â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚  â”‚ 2. Parse JSON         â”‚  â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚  â”‚ 3. Watermark          â”‚  â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚  â”‚ 4. Window aggregate   â”‚  â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚  â”‚ 5. Write to Parquet   â”‚  â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚
â”‚  â”‚              â”‚              â”‚    â”‚              â”‚              â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                 â”‚                                  â”‚                        â”‚
â”‚                 â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                        â”‚
â”‚                 â”‚      â”‚                   â”‚       â”‚                        â”‚
â”‚                 â””â”€â”€â”€â”€â”€â–ºâ”‚   SERVING LAYER   â”‚â—„â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                        â”‚                   â”‚                                â”‚
â”‚                        â”‚  week6_merge.py   â”‚                                â”‚
â”‚                        â”‚                   â”‚                                â”‚
â”‚                        â”‚  1. Read batch    â”‚                                â”‚
â”‚                        â”‚  2. Read streamingâ”‚                                â”‚
â”‚                        â”‚  3. Union         â”‚                                â”‚
â”‚                        â”‚  4. Deduplicate   â”‚                                â”‚
â”‚                        â”‚  5. Recompute MA  â”‚                                â”‚
â”‚                        â”‚  6. Save merged   â”‚                                â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                  â”‚                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           OUTPUT LAYER                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                  â–¼                                          â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                        â”‚  prophet_train.py â”‚                                â”‚
â”‚                        â”‚                   â”‚                                â”‚
â”‚                        â”‚  1. Load data     â”‚                                â”‚
â”‚                        â”‚  2. Grid search   â”‚                                â”‚
â”‚                        â”‚  3. Train Prophet â”‚                                â”‚
â”‚                        â”‚  4. Cross-valid   â”‚                                â”‚
â”‚                        â”‚  5. Visualize     â”‚                                â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                  â”‚                                          â”‚
â”‚                                  â–¼                                          â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                        â”‚     OUTPUTS       â”‚                                â”‚
â”‚                        â”‚                   â”‚                                â”‚
â”‚                        â”‚  â€¢ Forecasts      â”‚                                â”‚
â”‚                        â”‚  â€¢ Visualizations â”‚                                â”‚
â”‚                        â”‚  â€¢ Metrics (MAPE) â”‚                                â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2. Timeline dá»¯ liá»‡u

```
Timeline:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

     2012                    2025-09-25        2025-11-24        2025-12-03
       â”‚                          â”‚                 â”‚                 â”‚
       â–¼                          â–¼                 â–¼                 â–¼
â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â–º
       â”‚                          â”‚                 â”‚                 â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€ Historical CSV â”€â”€â–ºâ”‚                 â”‚                 â”‚
       â”‚      (Week 1-5 Pipeline) â”‚                 â”‚                 â”‚
       â”‚                          â”‚                 â”‚                 â”‚
       â”‚                          â”‚â—„â”€â”€â”€ Gap 1 â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
       â”‚                          â”‚   (60 days)     â”‚                 â”‚
       â”‚                          â”‚   Backfill #1   â”‚                 â”‚
       â”‚                          â”‚                 â”‚                 â”‚
       â”‚                          â”‚                 â”‚â—„â”€â”€â”€ Gap 2 â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                          â”‚                 â”‚   (9 days)      â”‚
       â”‚                          â”‚                 â”‚   Backfill #2   â”‚
       â”‚                          â”‚                 â”‚                 â”‚
       â”‚                          â”‚                 â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                          â”‚                 â”‚         â”‚Stream â”‚
       â”‚                          â”‚                 â”‚         â”‚(demo) â”‚
       â”‚                          â”‚                 â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                          â”‚                 â”‚                 â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Legend:
  â”€â”€â”€â”€â”€â”€  = Historical data (CSV)
  â”€ â”€ â”€   = Backfilled data (Batch Layer)
  â•â•â•â•â•â•â• = Streaming data (Speed Layer)
```

---

## 5. Luá»“ng dá»¯ liá»‡u chi tiáº¿t

### 5.1. Khi cháº¡y Batch Layer (week6_backfill.py)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BATCH LAYER FLOW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Detect last date
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ daily_filled/   â”‚ â”€â”€â–º Read Parquet â”€â”€â–º last_date = "2025-11-24"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 2: Calculate gap
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Today's date    â”‚ â”€â”€â–º today = "2025-12-03"
â”‚ 2025-12-03      â”‚     gap = 9 days (25/11 â†’ 03/12)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 3: Fetch from Binance API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Binance API     â”‚     â”‚ Raw 1-min data  â”‚
â”‚ /klines?symbol= â”‚ â”€â”€â–º â”‚ 24,230 rows     â”‚
â”‚ BTCUSDT&intervalâ”‚     â”‚ (BTC + ETH)     â”‚
â”‚ =1m             â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 4: Clean & Aggregate
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Raw 1-min data  â”‚     â”‚ Daily OHLC      â”‚
â”‚ 24,230 rows     â”‚ â”€â”€â–º â”‚ 18 rows         â”‚
â”‚                 â”‚     â”‚ (9 days Ã— 2)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 5: Compute MA7/MA30
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Daily OHLC      â”‚     â”‚ With MA columns â”‚
â”‚ open, high,     â”‚ â”€â”€â–º â”‚ + ma7           â”‚
â”‚ low, close, vol â”‚     â”‚ + ma30          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 6: Save to Parquet
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Processed data  â”‚     â”‚ daily_filled/   â”‚
â”‚ with MA7/MA30   â”‚ â”€â”€â–º â”‚ symbol=BTCUSDT/ â”‚
â”‚                 â”‚     â”‚ symbol=ETHUSDT/ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2. Khi cháº¡y Speed Layer (Kafka + Spark)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SPEED LAYER FLOW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Binance API    â”‚
                    â”‚  (ticker/24hr)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Poll every 1 second
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ websocket_      â”‚
                    â”‚ producer.py     â”‚
                    â”‚                 â”‚
                    â”‚ {               â”‚
                    â”‚   "symbol":     â”‚
                    â”‚     "BTCUSDT",  â”‚
                    â”‚   "price":      â”‚
                    â”‚     92817.92,   â”‚
                    â”‚   "volume":     â”‚
                    â”‚     29318.80,   â”‚
                    â”‚   ...           â”‚
                    â”‚ }               â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Send to Kafka
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           APACHE KAFKA                                  â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Topic: crypto-prices                          â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   Partition 0: [msg1] [msg3] [msg5] [msg7] ...                  â”‚   â”‚
â”‚  â”‚   Partition 1: [msg2] [msg4] [msg6] [msg8] ...                  â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Consume stream
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ spark_streaming_â”‚
                    â”‚ consumer.py     â”‚
                    â”‚                 â”‚
                    â”‚ 1. readStream   â”‚
                    â”‚ 2. Parse JSON   â”‚
                    â”‚ 3. Watermark    â”‚
                    â”‚    (1 hour)     â”‚
                    â”‚ 4. Window       â”‚
                    â”‚    (1 day)      â”‚
                    â”‚ 5. Aggregate    â”‚
                    â”‚    (OHLC)       â”‚
                    â”‚ 6. writeStream  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Output every 10 seconds
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ streaming_      â”‚
                    â”‚ output_spark/   â”‚
                    â”‚   daily/        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3. Khi cháº¡y Serving Layer (week6_merge.py)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SERVING LAYER FLOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BATCH DATA      â”‚           â”‚ STREAMING DATA  â”‚
â”‚ daily_filled/   â”‚           â”‚ streaming_      â”‚
â”‚                 â”‚           â”‚ output_spark/   â”‚
â”‚ 120 rows        â”‚           â”‚ daily/          â”‚
â”‚ (60 days Ã— 2)   â”‚           â”‚ X rows          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                             â”‚
         â”‚                             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ UNION
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ Combined Data   â”‚
               â”‚                 â”‚
               â”‚ Batch + Stream  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ DEDUPLICATE
                        â”‚ (remove overlapping dates)
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ Unique Dates    â”‚
               â”‚                 â”‚
               â”‚ No duplicates   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ RECOMPUTE MA7/MA30
                        â”‚ (for entire timeline)
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ Final Merged    â”‚
               â”‚                 â”‚
               â”‚ Ready for       â”‚
               â”‚ Prophet         â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ SAVE
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ daily_filled/   â”‚
               â”‚ prophet_input/  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. CÃ¡c cÃ´ng nghá»‡ sá»­ dá»¥ng

### 6.1. Tá»•ng quan cÃ´ng nghá»‡

| Layer | CÃ´ng nghá»‡ | PhiÃªn báº£n | Má»¥c Ä‘Ã­ch |
|-------|-----------|-----------|----------|
| Batch | PySpark | 3.5.3 | Xá»­ lÃ½ dá»¯ liá»‡u lá»›n |
| Batch | Binance API | v3 | Fetch dá»¯ liá»‡u lá»‹ch sá»­ |
| Speed | Apache Kafka | 7.5.0 | Message broker |
| Speed | Apache Zookeeper | 7.5.0 | Kafka coordination |
| Speed | Spark Structured Streaming | 3.5.3 | Stream processing |
| Speed | Docker | 27.5.1 | Container runtime |
| Serving | PySpark SQL | 3.5.3 | Merge & query |
| Output | Prophet | 1.1.5 | Time series forecast |
| Output | Plotly | 5.x | Interactive charts |

### 6.2. Chi tiáº¿t tá»«ng cÃ´ng nghá»‡

#### Apache Kafka
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         APACHE KAFKA                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Kafka lÃ  má»™t distributed streaming platform:                       â”‚
â”‚                                                                     â”‚
â”‚  â€¢ Producer: Gá»­i messages vÃ o Kafka                                â”‚
â”‚  â€¢ Consumer: Äá»c messages tá»« Kafka                                 â”‚
â”‚  â€¢ Topic: KÃªnh chá»©a messages (nhÆ° folder)                          â”‚
â”‚  â€¢ Partition: Chia nhá» topic Ä‘á»ƒ parallel processing                â”‚
â”‚  â€¢ Broker: Server cháº¡y Kafka                                       â”‚
â”‚                                                                     â”‚
â”‚  Trong project:                                                     â”‚
â”‚  â€¢ Topic: crypto-prices                                            â”‚
â”‚  â€¢ Partitions: 2                                                   â”‚
â”‚  â€¢ Broker: localhost:9092                                          â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Spark Structured Streaming
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SPARK STRUCTURED STREAMING                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Spark Structured Streaming xá»­ lÃ½ stream nhÆ° table:                 â”‚
â”‚                                                                     â”‚
â”‚  â€¢ readStream: Äá»c stream liÃªn tá»¥c                                 â”‚
â”‚  â€¢ Transformations: select, filter, groupBy (nhÆ° SQL)              â”‚
â”‚  â€¢ writeStream: Ghi output liÃªn tá»¥c                                â”‚
â”‚                                                                     â”‚
â”‚  CÃ¡c khÃ¡i niá»‡m quan trá»ng:                                         â”‚
â”‚                                                                     â”‚
â”‚  1. Watermark: Xá»­ lÃ½ late data                                     â”‚
â”‚     - Cho phÃ©p dá»¯ liá»‡u Ä‘áº¿n muá»™n 1 giá»                             â”‚
â”‚     - Dá»¯ liá»‡u Ä‘áº¿n sau watermark bá»‹ bá» qua                         â”‚
â”‚                                                                     â”‚
â”‚  2. Window: NhÃ³m dá»¯ liá»‡u theo thá»i gian                            â”‚
â”‚     - Daily window: Tá»•ng há»£p theo ngÃ y                             â”‚
â”‚                                                                     â”‚
â”‚  3. Trigger: Táº§n suáº¥t output                                       â”‚
â”‚     - 10 seconds: Output má»—i 10 giÃ¢y                               â”‚
â”‚                                                                     â”‚
â”‚  4. Checkpoint: Fault tolerance                                    â”‚
â”‚     - LÆ°u tráº¡ng thÃ¡i Ä‘á»ƒ recover khi crash                         â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Docker & Docker Compose
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DOCKER & DOCKER COMPOSE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Docker giÃºp cháº¡y Kafka + Zookeeper dá»… dÃ ng:                       â”‚
â”‚                                                                     â”‚
â”‚  â€¢ Container: MÃ´i trÆ°á»ng isolated                                  â”‚
â”‚  â€¢ Image: Template Ä‘á»ƒ táº¡o container                                â”‚
â”‚  â€¢ Volume: LÆ°u trá»¯ persistent                                      â”‚
â”‚  â€¢ Network: Káº¿t ná»‘i giá»¯a cÃ¡c containers                            â”‚
â”‚                                                                     â”‚
â”‚  docker-compose.yml Ä‘á»‹nh nghÄ©a:                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ services:                                  â”‚                    â”‚
â”‚  â”‚   zookeeper:                               â”‚                    â”‚
â”‚  â”‚     image: confluentinc/cp-zookeeper:7.5.0 â”‚                    â”‚
â”‚  â”‚     ports: 2181                            â”‚                    â”‚
â”‚  â”‚                                            â”‚                    â”‚
â”‚  â”‚   kafka:                                   â”‚                    â”‚
â”‚  â”‚     image: confluentinc/cp-kafka:7.5.0     â”‚                    â”‚
â”‚  â”‚     ports: 9092, 9093                      â”‚                    â”‚
â”‚  â”‚     depends_on: zookeeper                  â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Cáº¥u trÃºc thÆ° má»¥c

### 7.1. Cáº¥u trÃºc files Week 6

```
D:\BigDataProject\
â”‚
â”œâ”€â”€ ğŸ“„ week6_backfill.py           # Batch Layer - Backfill gap data
â”œâ”€â”€ ğŸ“„ week6_merge.py              # Serving Layer - Merge batch + streaming
â”œâ”€â”€ ğŸ“„ prophet_train.py            # Output - Forecast vá»›i Prophet
â”‚
â”œâ”€â”€ ğŸ“ week6_streaming/            # Speed Layer
â”‚   â”œâ”€â”€ ğŸ“„ docker-compose.yml      # Kafka + Zookeeper config
â”‚   â”œâ”€â”€ ğŸ“„ websocket_producer.py   # Producer: Binance â†’ Kafka
â”‚   â”œâ”€â”€ ğŸ“„ spark_streaming_consumer.py  # Consumer: Kafka â†’ Parquet
â”‚   â””â”€â”€ ğŸ“„ README.md               # HÆ°á»›ng dáº«n streaming
â”‚
â”œâ”€â”€ ğŸ“ data_analysis/              # Output data
â”‚   â”œâ”€â”€ ğŸ“ daily_filled/           # Backfilled data (partitioned)
â”‚   â”‚   â”œâ”€â”€ symbol=BTCUSDT/
â”‚   â”‚   â”‚   â””â”€â”€ year=2025/
â”‚   â”‚   â””â”€â”€ symbol=ETHUSDT/
â”‚   â”‚       â””â”€â”€ year=2025/
â”‚   â”œâ”€â”€ ğŸ“ prophet_input/          # Input cho Prophet
â”‚   â”œâ”€â”€ ğŸ“ week4_forecasts/        # Forecast má»›i
â”‚   â”œâ”€â”€ ğŸ“ week4_forecasts_old/    # Forecast cÅ© (backup)
â”‚   â”œâ”€â”€ ğŸ“ week4_visualizations/   # Biá»ƒu Ä‘á»“ má»›i
â”‚   â”œâ”€â”€ ğŸ“ week4_visualizations_old/  # Biá»ƒu Ä‘á»“ cÅ© (backup)
â”‚   â”œâ”€â”€ ğŸ“ week4_results/          # Actual vs Predicted
â”‚   â””â”€â”€ ğŸ“ week4_metrics/          # MAPE metrics
â”‚
â”œâ”€â”€ ğŸ“ streaming_output_spark/     # Streaming output
â”‚   â””â”€ ğŸ“ daily/                  # Daily aggregates
â”‚
â”œâ”€ ğŸ“ checkpoint_spark/           # Spark checkpoints
â”‚   â””â”€ ğŸ“ daily/
â”‚
â””â”€â”€ ğŸ“ logs/                       # Log files
    â””â”€â”€ ğŸ“„ prophet_train.log
```

### 7.2. Giáº£i thÃ­ch tá»«ng file

| File | DÃ²ng code | Má»¥c Ä‘Ã­ch |
|------|-----------|----------|
| `week6_backfill.py` | ~290 | Batch Layer: Detect gap, fetch API, clean, aggregate, save |
| `week6_merge.py` | ~160 | Serving Layer: Read batch + streaming, union, dedupe, save |
| `websocket_producer.py` | ~140 | Speed Layer: Poll Binance, send to Kafka |
| `spark_streaming_consumer.py` | ~270 | Speed Layer: Read Kafka, watermark, window, aggregate |
| `docker-compose.yml` | ~40 | Docker config for Kafka + Zookeeper |
| `prophet_train.py` | ~300 | Forecast: Grid search, train, evaluate, visualize |

---

## 8. CÃ¢u há»i thÆ°á»ng gáº·p tá»« giáº£ng viÃªn

### 8.1. CÃ¢u há»i vá» kiáº¿n trÃºc

**Q1: Táº¡i sao chá»n Lambda Architecture thay vÃ¬ Kappa Architecture?**

```
A: Lambda Architecture phÃ¹ há»£p hÆ¡n vÃ¬:

1. Kappa Architecture chá»‰ cÃ³ Speed Layer (streaming only)
   - KhÃ´ng xá»­ lÃ½ Ä‘Æ°á»£c historical data
   - KhÃ³ reprocess náº¿u cÃ³ lá»—i

2. Lambda cÃ³ cáº£ Batch + Speed:
   - Batch: Xá»­ lÃ½ chÃ­nh xÃ¡c dá»¯ liá»‡u lá»‹ch sá»­
   - Speed: Real-time cho dá»¯ liá»‡u má»›i
   - Serving: Merge cáº£ hai

3. Trong bÃ i toÃ¡n nÃ y:
   - CÃ³ CSV lá»‹ch sá»­ tá»« 2012 (cáº§n Batch)
   - Cáº§n demo streaming (cáº§n Speed)
   - Cáº§n forecast liÃªn tá»¥c (cáº§n Serving)

â†’ Lambda Architecture lÃ  lá»±a chá»n tá»‘i Æ°u
```

**Q2: Táº¡i sao cáº§n cáº£ Batch Layer khi Ä‘Ã£ cÃ³ Streaming?**

```
A: VÃ¬ hai layer giáº£i quyáº¿t hai váº¥n Ä‘á» khÃ¡c nhau:

Batch Layer:
- Xá»­ lÃ½ dá»¯ liá»‡u TRONG QUÃ KHá»¨ (khi mÃ¡y táº¯t)
- VÃ­ dá»¥: MÃ¡y táº¯t 9 ngÃ y â†’ cáº§n backfill 9 ngÃ y

Speed Layer:
- Xá»­ lÃ½ dá»¯ liá»‡u NGAY BÃ‚Y GIá»œ (khi mÃ¡y Ä‘ang cháº¡y)
- VÃ­ dá»¥: MÃ¡y Ä‘ang báº­t â†’ collect real-time

Náº¿u chá»‰ cÃ³ Streaming:
- Táº¯t mÃ¡y 9 ngÃ y â†’ máº¥t 9 ngÃ y dá»¯ liá»‡u
- KhÃ´ng cÃ³ cÃ¡ch nÃ o láº¥y láº¡i!

Vá»›i Lambda:
- Báº­t mÃ¡y láº¡i â†’ Batch tá»± Ä‘á»™ng backfill 9 ngÃ y
- Streaming tiáº¿p tá»¥c collect real-time
- KhÃ´ng máº¥t dá»¯ liá»‡u!
```

**Q3: Serving Layer cÃ³ vai trÃ² gÃ¬?**

```
A: Serving Layer lÃ  "cáº§u ná»‘i" giá»¯a Batch vÃ  Speed:

1. Merge:
   - Láº¥y data tá»« Batch (historical + backfill)
   - Láº¥y data tá»« Speed (streaming)
   - Káº¿t há»£p thÃ nh má»™t timeline

2. Deduplicate:
   - Loáº¡i bá» overlap (náº¿u cÃ³)
   - VÃ­ dá»¥: Batch vÃ  Speed cÃ¹ng cÃ³ data 03/12

3. Compute:
   - TÃ­nh láº¡i MA7, MA30 cho toÃ n bá»™ timeline
   - Äáº£m báº£o consistency

4. Serve:
   - Cung cáº¥p data cho Prophet
   - Format sáºµn sÃ ng Ä‘á»ƒ forecast
```

### 8.2. CÃ¢u há»i vá» implementation

**Q4: Kafka cÃ³ vai trÃ² gÃ¬ trong project?**

```
A: Kafka lÃ  Message Broker - trung gian giá»¯a Producer vÃ  Consumer:

Producer (websocket_producer.py):
- Poll giÃ¡ tá»« Binance má»—i giÃ¢y
- Gá»­i message vÃ o Kafka topic

Kafka:
- LÆ°u trá»¯ messages
- Äáº£m báº£o khÃ´ng máº¥t data
- Cho phÃ©p nhiá»u consumer cÃ¹ng Ä‘á»c

Consumer (spark_streaming_consumer.py):
- Äá»c messages tá»« Kafka
- Xá»­ lÃ½ vá»›i Spark Streaming

Táº¡i sao cáº§n Kafka thay vÃ¬ gá»­i tháº³ng?
- Decoupling: Producer/Consumer Ä‘á»™c láº­p
- Buffer: Kafka giá»¯ data náº¿u Consumer cháº­m
- Replay: CÃ³ thá»ƒ Ä‘á»c láº¡i data cÅ©
- Scalability: Dá»… scale Producer/Consumer
```

**Q5: Watermark vÃ  Window trong Spark Streaming lÃ  gÃ¬?**

```
A: 

WATERMARK:
- Äá»‹nh nghÄ©a: NgÆ°á»¡ng thá»i gian cháº¥p nháº­n late data
- Trong code: withWatermark("event_time", "1 hour")
- Ã nghÄ©a: Data Ä‘áº¿n muá»™n <= 1 giá» váº«n Ä‘Æ°á»£c xá»­ lÃ½

VÃ­ dá»¥:
  Current time: 10:00
  Watermark: 9:00 (10:00 - 1h)
  Data vá»›i event_time 9:30 â†’ ÄÆ°á»£c xá»­ lÃ½ âœ…
  Data vá»›i event_time 8:30 â†’ Bá»‹ drop âŒ

WINDOW:
- Äá»‹nh nghÄ©a: NhÃ³m data theo khoáº£ng thá»i gian
- Trong code: window(col("event_time"), "1 day")
- Ã nghÄ©a: Tá»•ng há»£p data theo tá»«ng ngÃ y

VÃ­ dá»¥:
  Window 1: 00:00 - 23:59 ngÃ y 03/12
  Window 2: 00:00 - 23:59 ngÃ y 04/12
  Má»—i window tÃ­nh OHLC riÃªng
```

**Q6: Táº¡i sao dÃ¹ng Parquet format?**

```
A: Parquet cÃ³ nhiá»u Æ°u Ä‘iá»ƒm cho Big Data:

1. Columnar Storage:
   - LÆ°u theo cá»™t, khÃ´ng theo hÃ ng
   - Query nhanh hÆ¡n khi SELECT Ã­t cá»™t

2. Compression:
   - NÃ©n tá»‘t (thÆ°á»ng 10x so vá»›i CSV)
   - Tiáº¿t kiá»‡m disk space

3. Schema:
   - LÆ°u schema trong file
   - KhÃ´ng cáº§n Ä‘á»‹nh nghÄ©a láº¡i khi Ä‘á»c

4. Partitioning:
   - Chia theo symbol, year
   - Query nhanh hÆ¡n

5. Predicate Pushdown:
   - Filter trÆ°á»›c khi Ä‘á»c
   - Äá»c Ã­t data hÆ¡n

So sÃ¡nh vá»›i CSV:
| TiÃªu chÃ­ | CSV | Parquet |
|----------|-----|---------|
| Size | 100MB | 10MB |
| Read speed | Slow | Fast |
| Schema | No | Yes |
| Partitioning | Manual | Built-in |
```

### 8.3. CÃ¢u há»i vá» káº¿t quáº£

**Q7: MAPE 4-5% cÃ³ tá»‘t khÃ´ng?**

```
A: MAPE (Mean Absolute Percentage Error) 4-5% lÃ  Káº¾T QUáº¢ Tá»T:

ÄÃ¡nh giÃ¡ MAPE:
| MAPE | ÄÃ¡nh giÃ¡ |
|------|----------|
| < 10% | Excellent (Xuáº¥t sáº¯c) |
| 10-20% | Good (Tá»‘t) |
| 20-50% | Acceptable (Cháº¥p nháº­n Ä‘Æ°á»£c) |
| > 50% | Poor (KÃ©m) |

Káº¿t quáº£ cá»§a project:
- BTCUSDT: MAPE ~4.67% â†’ Excellent
- ETHUSDT: MAPE ~4.39% â†’ Excellent

LÆ°u Ã½:
- Crypto ráº¥t volatile (biáº¿n Ä‘á»™ng máº¡nh)
- MAPE < 5% lÃ  ráº¥t áº¥n tÆ°á»£ng
- Chá»©ng tá» model Prophet phÃ¹ há»£p
```

**Q8: Auto backup hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o?**

```
A: Khi cháº¡y prophet_train.py:

1. Check thÆ° má»¥c week4_visualizations/ cÃ³ file khÃ´ng?
   - CÃ³ â†’ Tiáº¿p bÆ°á»›c 2
   - KhÃ´ng â†’ Skip (láº§n Ä‘áº§u cháº¡y)

2. Copy week4_visualizations/ â†’ week4_visualizations_old/
   - Ghi Ä‘Ã¨ náº¿u _old Ä‘Ã£ tá»“n táº¡i

3. Táº¡o biá»ƒu Ä‘á»“ má»›i vÃ o week4_visualizations/

Káº¿t quáº£:
â”œâ”€â”€ week4_visualizations/       â† Má»šI (láº§n cháº¡y nÃ y)
â”œâ”€â”€ week4_visualizations_old/   â† CÅ¨ (láº§n cháº¡y trÆ°á»›c)

TÆ°Æ¡ng tá»± cho:
- week4_forecasts/ & week4_forecasts_old/
- week4_results/ & week4_results_old/
- week4_metrics/ & week4_metrics_old/

Lá»£i Ã­ch:
- So sÃ¡nh trÆ°á»›c/sau
- Rollback náº¿u cáº§n
- Tracking progress
```

---

## ğŸ“š TÃ i liá»‡u tiáº¿p theo

Sau khi Ä‘á»c hiá»ƒu file nÃ y, hÃ£y tiáº¿p tá»¥c vá»›i:

1. **WEEK6_02_BATCH_LAYER.md** - Giáº£i thÃ­ch chi tiáº¿t `week6_backfill.py`
2. **WEEK6_03_SPEED_LAYER.md** - Giáº£i thÃ­ch Kafka + Spark Streaming
3. **WEEK6_04_SERVING_LAYER.md** - Giáº£i thÃ­ch merge + forecast

---

*Táº¡o bá»Ÿi: Big Data Project - Week 6 Documentation*
*Cáº­p nháº­t: 03/12/2025*
